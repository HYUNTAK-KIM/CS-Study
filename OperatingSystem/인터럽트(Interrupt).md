# 인터럽트(Interrupt)

인터럽트는 프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우, 현재 실행 중인 작업을 일시 중단하고, 발생된 상황을 우선 처리한 후, 실행 중이던 작업으로 복귀하여 계속 처리하는 메커니즘

1. 컨트롤러 (Controller)  
   - CPU와 입출력 장치 사이의 데이터 통신을 중재하는 역할을 하는 하드웨어 모듈
   - 각 입출력 장치에는 해당 장치와 CPU 간의 통신을 담당하는 컨트롤러가 존재하며, 장치의 기능에 맞는 다양한 명령을 수행
   - CPU가 입출력 장치의 내부 동작을 이해하지 않아도 입출력 작업을 수행할 수 있도록 함

   - 역할
     - 입출력 요청 수신 및 처리  
      CPU가 입출력 장치에 작업을 요청하면, 컨트롤러가 이를 수신해 독립적으로 작업을 수행합니다. CPU는 다른 작업을 이어서 처리할 수 있습니다.

     - 인터럽트 발생  
      작업이 완료되면 컨트롤러가 인터럽트를 발생시켜 CPU에 알립니다. CPU는 이 인터럽트를 처리해 입출력 작업을 마무리합니다.

     - 인터럽트 우선순위 관리  
      여러 인터럽트가 동시에 발생할 때, 컨트롤러가 우선순위를 관리해 중요한 작업을 먼저 처리할 수 있게 합니다.

2. 로컬 버퍼 (Local Buffer)  
   - 데이터 전송 속도 조정 및 임시 저장소

   - 역할
     - 데이터 임시 저장 및 속도 조정  
        로컬 버퍼는 입출력 장치가 느린 속도로 데이터를 처리할 때 데이터를 임시로 저장해 속도 차이를 줄임

     - 인터럽트 발생을 위한 준비  
        로컬 버퍼에 데이터가 충분히 채워지거나 비워지면, 컨트롤러는 CPU에 인터럽트를 발생시켜 버퍼에 쌓인 데이터를 처리할 준비가 되었음을 알림.  
        예를 들어, 입출력 장치에서 CPU로 데이터를 전송할 경우, 로컬 버퍼에 데이터가 가득 차면 컨트롤러는 인터럽트를 발생시켜 CPU가 이 데이터를 처리

### 인터럽트의 종류

- 외부 인터럽트
  - 전원 이상 인터럽트 : 정전, 파워 이상 등
  - 기계 착오 인터럽트 : CPU의 기능 오류
  - 외부 신호 인터럽트
    - 타이머에 의한 인터럽트 : CPU가 특정 프로세스를 일정 시간 동안만 실행하도록 하여 여러 프로세스가 공정하게 CPU 시간을 사용
    - 키보드로 인터럽트 키를 누른 경우 : 대표적으로 Ctrl + Alt + Delete
    - 외부장치로부터 인터럽트 요청이 있는 경우 : I/O 인터럽트 아님!! 다른 개념이다
  - I/O 인터럽트
    - 입출력장치가 데이터 전송을 요구하거나 전송이 끝나 다음 동작이 수행되어야 할 경우
    - 입출력 데이터에 이상이 있는 경우  
- 내부 인터럽트
  잘못된 명령이나 잘못된 데이터를 사용할때 발생하며 Trap이라 부름
  - 프로그램 검사 인터럽트
    - Division by zero
    - Overflow/Underflow
    - 기타 Exception
- 소프트웨어 인터럽트
  - 사용자가 프로그램을 실행시키거나 감시프로그램(Supervisor)을 호출하는 동작을 수행하는 경우
  - 소프트웨어 이용중 다른 프로세스를 실행시키면 시분할 처리를 위해 자원 할당 등의 동작이 수행

### 인터럽트 동작 순서

1. 인터럽트 요청
2. 프로그램 실행 중단 
   - 현재 실행중이던 Micro operation 까지 수행한다.
3. 현재의 프로그램 상태 보존 
   - PCB(Process Control Block), PC(Program Counter) 등
4. 인터럽트 처리루틴 실행 
   - 인터럽트를 요청한 장치를 식별한다.
5. 인터럽트 서비스 루틴 실행 
   - 인터럽트 원인을 파악하고 실질적인 작업을 수행한다. 처리기 레지스터 상태를 보존한다. 서비스 루틴 수행 중 우선순위가 더 높은 인터럽트가 발생하면 또 재귀적으로 1~5를 수행한다.
6. 상태복구 
   - 인터럽트 발생 시 저장해둔 PC(Program counter)를 다시 복구한다.
7. 중단된 프로그램 실행 재개 
   - PC의 값을 이용하여 이전에 수행중이던 프로그램을 재개한다.

### 인터럽트 예시

![인터럽트](/OperatingSystem/images/인터럽트.png)

1. 파일 읽기 요청 및 인터럽트 발생
   - **비동기 입출력(Asynchronous I/O)**
   - 디스크 컨트롤러는 파일을 읽는 작업을 시작, 읽기 작업이 완료되면 CPU에게 알리기 위한 인터럽트를 발생
2. 유저모드 -> 커널모드 전환
3. 인터럽트 처리루틴 실행
   - CPU는 인터럽트 벡터 테이블을 통해 인터럽트와 관련된 인터럽트 처리 루틴의 위치를 찾음
   - 파일 읽기와 관련된 디스크 인터럽트의 경우, 디스크 인터럽트 처리 루틴으로 이동
4. 인터럽트 서비스 루틴 실행
   - 디스크에서 읽은 데이터를 CPU가 접근할 수 있는 메모리로 이동
   - 파일 데이터가 로컬 버퍼에서 RAM으로 이동
5. 상태복구
   - CPU 레지스터와 프로그램 카운터의 값을 복구
6. 중단된 프로그램 실행 재개
   - 파일 읽기 결과를 처리하고, 이후 프로그램의 명령을 계속해서 실행

### 인터럽트 우선순위

인터럽트가 동시에 발생하거나 인터럽트 서비스 루틴 수행 중 인터럽트가 발생했을 경우 **우선순위**를 따져 처리  
> 전원 이상(Power fail) > 기계 착오(Machine Check) > 외부 신호(External) > 입출력(I/O) > 명령어 잘못 > 프로그램 검사(Program Check) > SVC(SuperVisor Call)

일반적으로 하드웨어 인터럽트 > 소프트웨어 인터럽트 // 외부 인터럽트 > 내부 인터럽트
